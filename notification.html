<!doctype html>
<html lang="mn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="NumForms - Мэдэгдэл">
    <meta name="author" content="">
    <title>NumForms - Мэдэгдэл</title>

    <!-- CSS FILES -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,500;0,700;1,400&display=swap" rel="stylesheet">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-icons.css" rel="stylesheet">
    <link href="css/tooplate-clean-work.css" rel="stylesheet">

    <style>
        .notification-card {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 12px 16px;
            margin-bottom: 10px;
            transition: background 0.2s;
        }
        .notification-card:hover {
            background: #e9ecef;
        }
        .notification-title {
            font-size: 1.05rem;
            font-weight: 500;
            color: #333;
        }
        .notification-date {
            font-size: 0.9rem;
            color: #999;
        }
        .notification-section {
            margin-bottom: 30px;
        }
        .notification-section h4 {
            font-size: 1.2rem;
            font-weight: 600;
            color: #444;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }
        .approve-btn, .reject-btn {
            padding: 4px 10px;
            font-size: 0.9rem;
        }
        .text-success {
            color: #28a745 !important;
        }
        .text-danger {
            color: #dc3545 !important;
        }
        .comment-section {
            font-size: 0.9rem;
            color: #555;
        }
        .date-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    </style>
</head>

<body>
    <!-- NAVIGATION -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img src="images/logo.png" class="logo img-fluid" alt="NumForms Logo">
                <span class="ms-2">NumForms</span>
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Нүүр</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#section_5" id="navbarLightDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">Маягт</a>
                        <ul class="dropdown-menu dropdown-menu-light" aria-labelledby="navbarLightDropdownMenuLink">
                            <li><a class="dropdown-item active" href="services.html">Өргөдөл</a></li>
                            <li><a class="dropdown-item" href="coming-soon.html">Маягт</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="contact.html">Ажилчдын хаяг</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="about.html">Бидний тухай</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="notification.html">
                            <i class="bi bi-bell-fill"></i> <span class="notificationBadge badge bg-warning">0</span>
                        </a>
                    </li>
                    <li class="nav-item ms-3">
                        <a class="nav-link custom-btn custom-border-btn custom-btn-bg-white btn" href="login.html">
                            <i class="bi bi-person-fill fs-5"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main>
        <!-- Banner Section -->
        <section class="banner-section d-flex justify-content-center align-items-end">
            <div class="section-overlay"></div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-7 col-12">
                        <h1 class="text-white mb-lg-0">Мэдэгдэл</h1>
                    </div>
                    <div class="col-lg-4 col-12 d-flex justify-content-lg-end align-items-center ms-auto">
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb justify-content-center">
                                <li class="breadcrumb-item"><a href="index.html">Нүүр</a></li>
                                <li class="breadcrumb-item active" aria-current="page">Мэдэгдэл</li>
                            </ol>
                        </nav>
                    </div>
                </div>
            </div>
        </section>

        <!-- Notifications Section -->
        <section class="notifications-section py-5">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-12 mx-auto">
                        <!-- Оюутны мэдэгдлүүд -->
                        <div id="studentNotificationList"></div>

                        <!-- Ажилтны хувьд: Шинэ хүсэлтүүд -->
                        <div class="notification-section" id="staffNewRequests" style="display: none;">
                            <h4>Шинээр ирсэн хүсэлтүүд</h4>
                            <div id="newRequestsList"></div>
                        </div>

                        <!-- Ажилтны хувьд: Бусад мэдэгдлүүд -->
                        <div class="notification-section" id="staffOtherNotifications" style="display: none;">
                            <h4>Бусад мэдэгдлүүд</h4>
                            <div id="staffNotificationList"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Comment Modal for Approve/Reject -->
            <div class="modal fade" id="commentModal" tabindex="-1" aria-labelledby="commentModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="commentModalLabel">Тайлбар оруулах</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="commentForm">
                                <div class="mb-3">
                                    <label for="commentText" class="form-label">Тайлбар</label>
                                    <textarea class="form-control" id="commentText" name="comment" rows="3" placeholder="Тайлбараа энд бичнэ үү..."></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Хаах</button>
                            <button type="button" class="btn btn-primary" id="confirmActionBtn">Хадгалах</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- FOOTER -->
    <footer class="site-footer">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-7 col-12 text-center mx-auto">
                    <h5 class="site-footer-title mb-3 fw-bold text-white">Холбоо барих</h5>
                    <ul class="list-unstyled mb-2">
                        <li class="mb-2">
                            <p class="text-white d-flex align-items-center justify-content-center mb-0">
                                <i class="bi-telephone-fill me-2"></i>
                                <a href="tel:99999999" class="site-footer-link text-white text-decoration-none">
                                    99-999-999
                                </a>
                            </p>
                        </li>
                        <li>
                            <p class="text-white d-flex align-items-center justify-content-center mb-0">
                                <i class="bi-envelope-fill me-2"></i>
                                <a href="mailto:20b1num1799@stud.num.edu.mn" class="site-footer-link text-white text-decoration-none">
                                    20b1num1799@stud.num.edu.mn
                                </a>
                            </p>
                        </li>
                    </ul>
                    <ul class="social-icon mt-4">
                        <li class="social-icon-item">
                            <a href="#" class="social-icon-link button button--skoll">
                                <span></span>
                                <span class="bi-twitter"></span>
                            </a>
                        </li>
                        <li class="social-icon-item">
                            <a href="#" class="social-icon-link button button--skoll">
                                <span></span>
                                <span class="bi-facebook"></span>
                            </a>
                        </li>
                        <li class="social-icon-item">
                            <a href="#" class="social-icon-link button button--skoll">
                                <span></span>
                                <span class="bi-instagram"></span>
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="col-lg-7 col-12 text-center mx-auto">
                    <br>
                    <p class="copyright-text mb-0 text-white-50">Copyright © 2025 NumForms. Бүх эрх хуулиар хамгаалагдсан.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- JAVASCRIPT FILES -->
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.backstretch.min.js"></script>
    <script src="js/counter.js"></script>
    <script src="js/countdown.js"></script>
    <script src="js/init.js"></script>
    <script src="js/modernizr.js"></script>
    <script src="js/animated-headline.js"></script>
    <script src="js/custom.js"></script>

    <!-- Inline JavaScript for dynamic notifications -->
    <script>
        // Жишээ мэдэгдлийн өгөгдөл (ирээдүйд backend-ээс татна)
        const studentNotifications = [
            {
                title: "Өргөдөл батлагдлаа",
                text: "Таны илгээсэн 'Хичээл цуцлах өргөдөл' батлагдсан байна. Дэлгэрэнгүй мэдээллийг имэйлээс шалгана уу.",
                date: "2025-04-17 09:00"
            },
            {
                title: "Маягт дутуу байна",
                text: "Таны 'Хувийн төлөвлөгөө өөрчлөх' маягт дутуу бөглөгдсөн байна. Шаардлагатай талбаруудыг бөглөнө үү.",
                date: "2025-04-16 14:30"
            },
            {
                title: "Системийн шинэчлэл",
                text: "NumForms системд шинэ функц нэмэгдлээ: Одоо та маягтаа PDF хэлбэрээр хадгалах боломжтой.",
                date: "2025-04-15 10:00"
            }
        ];

        // Ажилтны шинэ хүсэлтүүд
        const newRequests = [
            {
                title: "Хичээл цуцлах өргөдөл",
                student: "Золжаргал",
                studentId: "20B1NUM1234",
                date: "2025-04-17",
                status: "Хүлээгдэж байна",
                attachment: "attachments/request1.pdf"
            },
            {
                title: "Дүнгийн маргаан",
                student: "Данзандорж",
                studentId: "20B1NUM5678",
                date: "2025-04-16",
                status: "Хүлээгдэж байна",
                attachment: "attachments/request2.pdf"
            }
        ];

        // Ажилтны бусад мэдэгдлүүд
        const staffNotifications = [
            {
                title: "Системийн шинэчлэл амжилттай хийгдлээ",
                date: "2025-04-14"
            },
            {
                title: "Сургалтын хөтөлбөрийн шинэчлэл зарлагдлаа",
                date: "2025-04-13"
            }
        ];

        // Хэрэглэгчийн төрлийг тодорхойлох функц
        function determineUserType(email) {
            const studentPattern = /^[0-9]{2}B1NUM[0-9]{4}@stud\.num\.edu\.mn$/i;
            if (studentPattern.test(email)) {
                return "student";
            } else if (email.includes('@stud.num.edu.mn') && email.includes('.')) {
                return "staff";
            }
            return "unknown";
        }

        // Оюутны мэдэгдэл нэмэх функц
        function addStudentNotification(notification, index) {
            const notificationList = document.getElementById('studentNotificationList');
            const notificationItem = document.createElement('div');
            notificationItem.classList.add('card', 'mb-3', 'shadow-sm');
            notificationItem.setAttribute('data-index', index);
            notificationItem.innerHTML = `
                <div class="card-body">
                    <h5 class="card-title">${notification.title}</h5>
                    <p class="card-text">${notification.text}</p>
                    <p class="card-text date-row">
                        <small class="text-muted">${notification.date}</small>
                        <a href="#" class="btn btn-sm custom-btn custom-border-btn custom-btn-bg-white mark-as-read">Уншсан</a>
                    </p>
                </div>
            `;
            notificationList.appendChild(notificationItem);

            // "Уншсан" товчны үйлдэл
            notificationItem.querySelector('.mark-as-read').addEventListener('click', function(e) {
                e.preventDefault();
                notificationItem.remove();
                updateNotificationCount();
            });
        }

        // Ажилтны шинэ хүсэлт нэмэх функц
        function addNewRequest(item, index) {
            const requestsList = document.getElementById('newRequestsList');
            const requestItem = document.createElement('div');
            requestItem.classList.add('notification-card');
            requestItem.setAttribute('data-index', index);
            requestItem.innerHTML = `
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <span class="notification-title">${item.student}: ${item.title}</span>
                        <span class="notification-status ms-2">(${item.status})</span>
                        <div class="request-student text-muted">${item.student} (${item.studentId})</div>
                        <a href="${item.attachment}" target="_blank" class="attachment-link small">Хавсралтыг харах</a>
                    </div>
                    <div>
                        <small class="notification-date me-2">${item.date}</small>
                        <button class="btn btn-sm btn-success approve-btn me-1" onclick="showCommentModal(${index}, 'approve')">Батлах</button>
                        <button class="btn btn-sm btn-danger reject-btn" onclick="showCommentModal(${index}, 'reject')">Татгалзах</button>
                    </div>
                </div>
                <div class="comment-section mt-2" style="display: none;">
                    <strong>Тайлбар:</strong>
                    <p class="comment-text mb-0"></p>
                </div>
            `;
            requestsList.appendChild(requestItem);
        }

        // Ажилтны бусад мэдэгдэл нэмэх функц
        function addStaffNotification(item, index) {
            const notificationList = document.getElementById('staffNotificationList');
            const notificationItem = document.createElement('div');
            notificationItem.classList.add('notification-card');
            notificationItem.setAttribute('data-index', index);
            notificationItem.innerHTML = `
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <span class="notification-title">${item.title}</span>
                    </div>
                    <small class="notification-date">${item.date}</small>
                </div>
            `;
            notificationList.appendChild(notificationItem);
        }

        // Тайлбарын modal-ыг харуулах функц
        function showCommentModal(index, action) {
            const modal = new bootstrap.Modal(document.getElementById('commentModal'));
            const confirmBtn = document.getElementById('confirmActionBtn');
            document.getElementById('commentText').value = '';

            confirmBtn.onclick = function() {
                const comment = document.getElementById('commentText').value;
                if (action === 'approve') {
                    approveRequest(index, comment);
                } else {
                    rejectRequest(index, comment);
                }
                modal.hide();
            };

            modal.show();
        }

        // Хүсэлтийг батлах функц
        function approveRequest(index, comment) {
            const requestItem = document.querySelector(`#newRequestsList [data-index="${index}"]`);
            if (requestItem) {
                const statusSpan = requestItem.querySelector('.notification-status');
                statusSpan.textContent = "(Батлагдсан)";
                statusSpan.classList.add('text-success');
                requestItem.querySelector('.approve-btn').style.display = 'none';
                requestItem.querySelector('.reject-btn').style.display = 'none';

                const commentSection = requestItem.querySelector('.comment-section');
                const commentText = requestItem.querySelector('.comment-text');
                commentText.textContent = comment || "Тайлбар байхгүй";
                commentSection.style.display = 'block';
            }
        }

        // Хүсэлтийг татгалзах функц
        function rejectRequest(index, comment) {
            const requestItem = document.querySelector(`#newRequestsList [data-index="${index}"]`);
            if (requestItem) {
                const statusSpan = requestItem.querySelector('.notification-status');
                statusSpan.textContent = "(Татгалзсан)";
                statusSpan.classList.add('text-danger');
                requestItem.querySelector('.approve-btn').style.display = 'none';
                requestItem.querySelector('.reject-btn').style.display = 'none';

                const commentSection = requestItem.querySelector('.comment-section');
                const commentText = requestItem.querySelector('.comment-text');
                commentText.textContent = comment || "Тайлбар байхгүй";
                commentSection.style.display = 'block';
            }
        }

        // Мэдэгдлийн тоог шинэчлэх функц
        function updateNotificationCount(userType) {
            const notificationBadge = document.querySelector('.notificationBadge');
            let notificationCount = 0;

            if (userType === "student") {
                notificationCount = document.querySelectorAll('#studentNotificationList .card.mb-3').length;
            } else if (userType === "staff") {
                const newRequestsCount = document.querySelectorAll('#newRequestsList .notification-card').length;
                const staffNotificationsCount = document.querySelectorAll('#staffNotificationList .notification-card').length;
                notificationCount = newRequestsCount + staffNotificationsCount;
            }

            notificationBadge.textContent = notificationCount;
        }

        // Хэрэглэгчийн мэдээлэл
        let userProfile = {
            email: "20b1num1799@stud.num.edu.mn"
        };

        // Хуудас ачааллахдаа
        document.addEventListener('DOMContentLoaded', function() {
            const userType = determineUserType(userProfile.email);
            console.log("User Type:", userType);

            if (userType === "student") {
                // Оюутны мэдэгдлүүдийг харуулах
                document.getElementById('studentNotificationList').style.display = 'block';
                document.getElementById('staffNewRequests').style.display = 'none';
                document.getElementById('staffOtherNotifications').style.display = 'none';

                // Огноогоор эрэмбэлэх (хамгийн сүүлийнх дээрээ)
                studentNotifications.sort((a, b) => new Date(b.date) - new Date(a.date));
                studentNotifications.forEach((item, index) => {
                    addStudentNotification(item, index);
                });

                updateNotificationCount(userType);
            } else if (userType === "staff") {
                // Ажилтны мэдэгдлүүдийг харуулах
                document.getElementById('studentNotificationList').style.display = 'none';
                document.getElementById('staffNewRequests').style.display = 'block';
                document.getElementById('staffOtherNotifications').style.display = 'block';

                // Шинэ хүсэлтүүдийг огноогоор эрэмбэлэх
                newRequests.sort((a, b) => new Date(b.date) - new Date(a.date));
                newRequests.forEach((item, index) => {
                    addNewRequest(item, index);
                });

                // Бусад мэдэгдлүүдийг огноогоор эрэмбэлэх
                staffNotifications.sort((a, b) => new Date(b.date) - new Date(a.date));
                staffNotifications.forEach((item, index) => {
                    addStaffNotification(item, index);
                });

                updateNotificationCount(userType);
            }
        });
    </script>
</body>
</html>